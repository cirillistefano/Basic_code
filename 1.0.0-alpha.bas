$Debug
'60,60
Data 1,1,1,14,14,14,14,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,14,14,14,14,14,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,14,14,14,14,14,14,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,14,14,14,14,14,14,14,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,14,14,14,14,14,14,14,14,1,1,1,1,1,1,1,1,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,1,1,1,1,1,1,1,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,1,1,1,1,1,1,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,1,1,1,1,1,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,14,1,1,1,1,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,14,14,1,1,1,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,14,14,14,1,1,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,1,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,1,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,1
Data 1,1,1,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,1,1
Data 1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1
Data 1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1
Data 1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1
Data 1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,1,1
Data 1,7,3,7,3,3,7,3,7,3,3,7,3,3,3,7,3,3,7,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1

Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
Data 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
















DECLARE FUNCTION rectRect% (r1x%, r1y%, r1w%, r1h%, r2x%, r2y%, r2w%, r2h%)
DECLARE SUB PlotLine (x1 AS INTEGER, y1 AS INTEGER, x2 AS INTEGER, y2 AS INTEGER, colore AS INTEGER)
DECLARE SUB Switch (x AS INTEGER, y AS INTEGER)
DECLARE SUB PlotRotta (StartX, StartY, x, y, z)
' $DYNAMIC
Randomize Timer
'Dim Shared winddirezione!
Dim Shared accelerazione!
Dim Shared Pascal As Single
Dim Shared kb(128) As Integer, lastk As Integer
Dim Shared kbleft As Integer, kbright As Integer, kbesc As Integer

'Const true = 1: false = 0



'DIM SHARED Sea(4) AS INTEGER
DefInt A-Z

Dim Shared bg(0)
Type ship
    PruaX As Integer
    PruaY As Integer
    sailarea As Double
    timoneangle As Double
End Type
Type windtype
    direzione As Long
    forza As Long
    velocita As Long
End Type
Type andatura
    direzione As Integer
End Type
Type timone
    angolo As Double
End Type
Dim Shared barra As timone
Dim Shared bolina As andatura
Dim Shared poppa As andatura
Dim Shared pi!
Dim Shared angle
'Dim Shared barca%(43, 48)
Dim Boa%(1 To 32)
Dim Barca%(19, 25)
Dim Mask%(19, 25)
pi! = 3.14159
Screen 12
View (0, 0)-(630, 470), 1, 9

Line (10, 10)-(610, 450), 2, B
'Color 10, 1
'La direzione del vento
Circle (520, 50), 25, 4
Paint (540, 50), 3, 4
Circle (520, 50), 20, 10
t = Atn(315)
For i = 1 To 40
    PSet (520 + i * -Sin(t), 50 + i), 14
Next i
'Dim Timone&
'Timone& = _LoadImage("timone.png", 32)
'Screen Timone&

Sleep 10
'Reading data and writing the sprite

' End of sprite
For Z = 0 To 25
    For j = 0 To 19

        Read Barca%(j, Z)
        'PSet (10 + j, 230 + Z), DotColor
    Next j
Next Z
For Z = 0 To 25
    For j = 0 To 19

        Read Mask%(j, Z)
        PSet (10 + j, 230 + Z), 255
    Next j
Next Z



wind.direzione! = 1.56 'Radians
wind.forza = 10
wind.velocita! = .5 * wind.forza
ship.sailarea = 20
'REM La riga seguente calcola la pressione del vento sulla vela x mq
Pascal! = (wind.velocita! ^ 2) * .613
angolodibolina! = wind.direzione! + .66
barra.angolo = angolodibolina!

Rem F=m*a quindi a=F/m
accelerazione! = (Pascal! * ship.sailarea) / 154

'Debug informations
Print "Wind Speed"; wind.forza; "knots"
Print Using "##.####^^^^"; angolodibolina!
Print Using "##.###^^^^"; accelerazione!
'Differenziale
der! = accelerazione! / angolodibolina!
Print Using "##.###^^^^"; der!



bolina.direzione = true
x% = 12
y% = 230
w% = 20
h% = 26

rx% = 65
ry% = 30
rh% = 520
rw% = 50
Line (rx%, ry%)-(rh%, rw%), 6, B
'Call PlotLine(65, 10, 520, 10, 7)
'Call PlotLine(65, 420, 520, 420, 7)
Circle (510, 220), 10, 5
'Call PlotLine(65, 10, 65, 50, 7)
'Call PlotLine(65, 50, 520, 50, 7)
'Call PlotLine(520, 10, 520, 50, 7)


lastx% = 0
lasty% = 0
lastw% = 0
lasth% = 0




dx = 1
dy = 1

PUT2 Barca%(), 20, 26, x%, y%

Do
    Sleep

    'PUT2 Barca%(), 20, 26, x, y
    px = x%
    py = y%

    PUT2 Mask%(), 20, 26, px, py
    Wait &H3DA, 8
    PSet (px, py - 5), 8


    'Call Getkeys

    kb$ = InKey$

    If kb$ = Chr$(0) + Chr$(75) Then


        'barra.angolo = barra.angolo - .06
        angolodibolina! = Round((angolodibolina! - .02), 3)
        der! = Round((accelerazione! / angolodibolina!), 3)
        'Wait &H3DA, 8: Wait &H3DA, 8, 8
        'PUT2 Barca%(), 60, 60, x + der!, y - angolodibolina!
        'If angolodibolina! <= .54 Then
        'angolodibolina! = angolodibolina! + 1.02
        'der! = (accelerazione! / (angolodibolina!))

        'Print angolodibolina!; ""; der!

        'PSet (Point(0) + der!, Point(1) - (angolodibolina!))
        x% = x% + der!
        y% = y% - angolodibolina!
        'PUT2 Barca%(), 20, 26, x, y
        'Wait &H3DA, 8


    End If
    If kb$ = Chr$(0) + Chr$(77) Then
        angolodibolina! = Round((angolodibolina! + .02), 3)
        der! = Round((accelerazione! / angolodibolina!), 3)
        x% = x% + der!
        y% = y% + angolodibolina!
        'Wait &H3DA, 8: Wait &H3DA, 8, 8
        'PSet (Point(0) + der!, Point(1) + (angolodibolina!))
        'PUT2 Barca%(), 20, 26, x, y
        'Wait &H3DA, 8: Wait &H3DA, 8, 8
        'Print angolodibolina!; ""; der!
        'der! = (accelerazione! \ Abs(angolodibolina!))

    End If
    If kb$ = Chr$(0) + Chr$(72) Then

        angolodipoppa! = Round((wind.direzione!), 3)

        der! = Round((accelerazione! / angolodipoppa!), 3)
        x% = x% - angolodipoppa!
        y% = y% + der!

        'Print v!; ""; der!
        '        angolodibolina! = angolodibolina! * (-1)
        '       der! = Abs(accelerazione! \ (angolodibolina!))
        'PSet (Point(0) + der!, Point(1) - (angolodibolina!))

        'der! = (accelerazione! \ Abs(angolodibolina!))
        'PSet (Point(0) + der!, Point(1) - (angolodibolina!))
    End If
    If kb$ = Chr$(0) + Chr$(80) Then

        angolodipoppa! = Round((wind.direzione!), 3)

        der! = Round((accelerazione! / angolodipoppa!), 3)
        x% = x% - angolodipoppa!
        y% = y% - der!
    End If
    'Print angolodibolina!; ""; der!
    'PSet (Point(0) + angolodibolina!, Point(1) + der!)
    For i = 1 To 3000
    Next i


    PUT2 Barca%(), 20, 26, x%, y%
    Wait &H3DA, 8
    'PSet (x, y), 9
    'Print "X"; x; "Y"; y
    If (lastx% <> x%) Or (lasty% <> y%) Or (lastw% <> w%) Or (lasth% <> h%) Then
        lastx% = x%
        lasty% = y%
        lastw% = w%
        lasth% = h%

        If rectRect%(x%, y%, 20, 26, rx%, ry%, rw%, rh%) = 1 Then
            hit$ = "HIT"
            'Line (10, 10)-(580, 450), 7, B
        Else
            hit$ = "NO HIT"

        End If
        'Print hit$
    End If
Loop Until kb$ = Chr$(27)
bolina.direzione = false
poppa.direzione = true

Print Using "##.####^^^^"; angolodibolina!
Print Using "##.####^^^^"; accelerazione!
Print Using "##.####^^^^"; der!

Print "Corrente posx"; PMap(Point(0), 0)
Print "Corrente posy"; PMap(Point(1), 1)
'x = 10
'y = 200
Print hit$
distx = Point(0) - x
disty = Abs(Point(1) - y)
'distanza! = Sqr(distx ^ 2 - disty ^ 2)
Print "Distanza percorsa: "; distanza!
End

Function rectRect% (r1x%, r1y%, r1w%, r1h%, r2x%, r2y%, r2w%, r2h%)

    ' are the sides of one rectangle touching the other?
    ' r1 right edge past r2 left
    ' r1 left edge past r2 right
    ' r1 top edge past r2 bottom
    ' r1 bottom edge past r2 top

    If (r1y% + r1h% <= r2y%) Then

        rectRect% = 1
    Else
        rectRect% = 0
    End If
End Function








'Print "Corrente posx"; PMap(der! * 100, 0)
'Print "Corrente posy"; PMap(200 + (angolodibolina! * 100), 1)





'Call PlotRotta(1, 100, 101, 150, 7)
Sub PUT2 (Sprite() As Integer, XSize As Integer, YSize As Integer, X As Integer, Y As Integer)
    ' Draw the sprite from the array onto the screen
    For YP = 0 To YSize - 1
        For XP = 0 To XSize - 1
            PSet (X + XP, Y + YP), Sprite%(XP, YP)
        Next XP
    Next YP
End Sub








Sub PlotLine (x1, y1, x2, y2, colore)
    DefInt A-Z
    Dim a, b As Double
    If Abs(x1 - x2) > Abs(y1 - y2) Then
        If x1 > x2 Then
            Call Switch(x1, x2)
            Call Switch(y1, y2)


        End If
        dx = (x2 - x1)
        dy = (y2 - y1)
        If dx <> 0 Then
            b! = dy / dx
        Else
            b! = 0
        End If
        a! = y1 - x1 * b!
        For x = x1 To x2
            y = Int((((a! + x * b!) + .05) * 10) / 10)
            PSet (x, y), colore
        Next x





    Else
        If y1 > y2 Then
            Call Switch(y1, y2)
            Call Switch(x1, x2)
        End If
        dx = (x2 - x1)
        dy = (y2 - y1)
        If dx <> 0 Then
            b! = dy / dx
        Else
            b! = 0

        End If


        a! = y1 - x1 * b!


        For y = y1 To y2
            If b! <> 0 Then
                x = Int(((((y - a!) / b!) + .05) * 10) / 10)
            Else
                x = x1
            End If
            PSet (x, y), colore
        Next y

    End If










End Sub

Sub Switch (x, y)
    t = x
    x = y
    y = t

End Sub
Sub PlotRotta (StartX, StartY, x, y, z)


    Print Using "!!.!!!!^^^^"; accelerazione!
    Call PlotLine(Sin(angolodibolina) * StartX * accelerazione!, Cos(angolodibolina) * StartY * accelerazione!, x, y, z)




End Sub
Function Round (Num, Decimals)
    n = Num * (10 ^ Decimals)
    n = Sgn(n) * (Abs(Int(n + .5)))
    Round = n / (10 ^ Decimals)
End Function





